---
    -   hosts: open5gs
        become: yes
        remote_user: root
        vars:
            ROOT_SRC_DIR : "/root"
            HOME_DIR: "/root"
            AMF_NGAP_IP_ADDRESS: "127.0.0.1"
            SYSTEM_MD_DIR: "/etc/systemd/system"
            OPEN5GS_WEBUI_CHECKOUT_FOLDER_NAME: "/root/open5gs/webui"
            OPEN5GS_CHECKOUT_FOLDER_NAME: "/root/open5gs"
            OPEN5GS_GIT_CHECKOUT_URL: "https://github.com/open5gs/open5gs.git"
            
        tasks:

            - set_fact:
                AMF_NGAP_IP_ADDRESS: "{{ ansible_default_ipv4.address }}"

            - name: Upgrade all apt packages
              apt: upgrade=dist force_apt_get=yes

            - name: Create a script to add UE to MongoDB
              copy:
                content: |
                  db = db.getSiblingDB('open5gs');
                  db.subscribers.insert({
                    "imsi": "2089300007488",
                    "auth": {
                      "k": "7488250214c33e723a5dd523fc145fc0",
                      "opc": "7488464c7c52eb6e5036234984ad0bcf",
                      "op": "7488763286b5b9ffbdf56e1297d0887b",
                      "sqn": "7488b3f70fc0"
                    },
                    "msin": "00007488",
                    "hplmn": {
                      "mcc": "208",
                      "mnc": "93"
                    },
                    "ran_ue_ngap_id": 1,
                    "amf_ue_ngap_id": 1,
                    "security": {
                      "k": "7488250214c33e723a5dd523fc145fc0",
                      "amf": "8000",
                      "op": "7488763286b5b9ffbdf56e1297d0887b",
                      "opc": "7488464c7c52eb6e5036234984ad0bcf"
                    },
                    "slice": {
                      "default": {
                        "sst": 1,
                        "sd": "010203"
                      }
                    },
                    "ambr": {
                      "uplink": 100000000,
                      "downlink": 200000000
                    },
                    "auc_3gpp": {
                      "milenage": {
                        "op": "7488763286b5b9ffbdf56e1297d0887b",
                        "opc": "7488464c7c52eb6e5036234984ad0bcf"
                      }
                    },
                    "type": 1
                  });
                dest: /tmp/add_non3gpp_ue.js

            - name: Register non-3GPP UE in MongoDB
              command: mongo /tmp/add_non3gpp_ue.js

            - name: Clean up the script
              file:
                path: /tmp/add_non3gpp_ue.js
                state: absent